<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>NZBP</title>
  <meta name="description" content="NZBP — installable, offline, and simple.">
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" href="./assets/icons/favicon.ico" sizes="any">
  <link rel="icon" href="./assets/icons/icon-192.png" type="image/png">
  <link rel="apple-touch-icon" href="./assets/icons/icon-192.png">
  <style>
    :root {
      --radius: 16px;
      --shadow: 0 10px 30px rgba(0,0,0,.15);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      /* Emerald (default) */
      --bg: #0b1020;
      --panel: #111827;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --brand: #10b981;
      --brand-2: #065f46;
      --accent: #34d399;
      --link: #a7f3d0;
      --danger: #ef4444;
    }
    [data-theme="sapphire"]{
      --bg: #0a0f1f;
      --panel: #0f172a;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --brand: #3b82f6;
      --brand-2: #1e40af;
      --accent: #60a5fa;
      --link: #bfdbfe;
    }
    [data-theme="amethyst"]{
      --bg: #1b1022;
      --panel: #1f1430;
      --text: #f3e8ff;
      --muted: #c4b5fd;
      --brand: #8b5cf6;
      --brand-2: #5b21b6;
      --accent: #a78bfa;
      --link: #ddd6fe;
    }
    [data-theme="chrome"]{
      --bg: #f8fafc;
      --panel: #ffffff;
      --text: #0f172a;
      --muted: #475569;
      --brand: #2563eb;
      --brand-2: #1e3a8a;
      --accent: #3b82f6;
      --link: #1d4ed8;
    }
    [data-theme="neutral"]{
      --bg: #0e1116;
      --panel: #161b22;
      --text: #e6edf3;
      --muted: #9aa7b2;
      --brand: #94a3b8;
      --brand-2: #64748b;
      --accent: #cbd5e1;
      --link: #e2e8f0;
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: radial-gradient(1200px 800px at 20% -10%, rgba(255,255,255,0.07), transparent 60%),
                  radial-gradient(1000px 700px at 120% 0%, rgba(255,255,255,0.05), transparent 55%),
                  var(--bg);
      color: var(--text);
      font-family: var(--font);
      line-height: 1.5;
    }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 24px; }
    header {
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
      padding: 16px 0 8px;
    }
    .brand { display: flex; align-items: center; gap: 12px; text-decoration: none; color: var(--text);}
    .brand img { width: 42px; height: 42px; border-radius: 10px; }
    .brand h1 { font-size: 1.4rem; margin: 0; }
    .panel { background: linear-gradient(180deg, color-mix(in srgb, var(--panel) 85%, black) 0%, var(--panel) 100%);
      border: 1px solid color-mix(in srgb, var(--panel), white 10%);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .hero { padding: 28px; display: grid; grid-template-columns: 1.15fr 1fr; gap: 20px; }
    .hero h2 { margin: 0 0 8px; font-size: clamp(1.6rem, 2vw + 1rem, 2.2rem); }
    .hero p { margin: 0 0 16px; color: var(--muted); }
    .cta { display: flex; gap: 12px; flex-wrap: wrap; }
    .btn { border: 0; border-radius: 14px; padding: 12px 16px; background: var(--brand); color: #0b1020; font-weight: 700; cursor: pointer;
      box-shadow: 0 6px 16px color-mix(in srgb, var(--brand) 40%, black);
    }
    .btn.secondary { background: transparent; color: var(--text); border: 1px solid color-mix(in srgb, var(--text), transparent 70%); }
    .btn.danger { background: var(--danger); color: #fff; }
    .grid { display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
    .card { padding: 16px; border-radius: 14px; background: color-mix(in srgb, var(--panel) 92%, black); border: 1px solid color-mix(in srgb, var(--panel), white 12%); }
    .toolbar { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; padding: 12px 16px; background: color-mix(in srgb, var(--panel) 95%, black); border-top: 1px solid color-mix(in srgb, var(--panel), white 10%); border-radius: 0 0 var(--radius) var(--radius);}
    .theme { display: inline-flex; gap: 8px; align-items: center; padding: 8px; background: color-mix(in srgb, var(--panel) 94%, black); border-radius: 999px; }
    .swatch { width: 28px; height: 28px; border-radius: 999px; border: 2px solid rgba(255,255,255,.5); cursor: pointer; }
    .swatch[data-name="emerald"] { background: linear-gradient(135deg, #10b981, #34d399); }
    .swatch[data-name="sapphire"] { background: linear-gradient(135deg, #3b82f6, #60a5fa); }
    .swatch[data-name="amethyst"] { background: linear-gradient(135deg, #8b5cf6, #a78bfa); }
    .swatch[data-name="chrome"] { background: linear-gradient(135deg, #2563eb, #60a5fa); border-color: rgba(0,0,0,.2); }
    .swatch[data-name="neutral"] { background: linear-gradient(135deg, #94a3b8, #cbd5e1); }
    label { display:block; margin: 6px 0 4px; font-size: .95rem; color: var(--muted); }
    input[type="text"], input[type="number"], input[type="url"], textarea {
      width: 100%; border-radius: 10px; border: 1px solid color-mix(in srgb, var(--panel), white 16%);
      padding: 10px 12px; background: color-mix(in srgb, var(--panel) 96%, black); color: var(--text);
    }
    input:focus, textarea:focus { outline: 2px solid color-mix(in srgb, var(--brand), white 10%); border-color: var(--brand); }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px; border-bottom: 1px solid color-mix(in srgb, var(--panel), white 10%); text-align: left; }
    .actions { display: flex; gap: 6px; flex-wrap: wrap; }
    .muted { color: var(--muted); }
    footer { margin: 24px 0 40px; color: var(--muted); text-align: center; font-size: .95rem; }
    .hint { display:none; align-items:center; gap:10px; margin:10px 0; padding:10px 14px; }
    .toast { position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%); background: var(--panel); border:1px solid color-mix(in srgb, var(--panel), white 14%); padding:10px 14px; border-radius: 10px; display:none; z-index: 50;}
  </style>
</head>
<body>
  <div class="wrap" id="top">
    <header>
      <a class="brand" href="#top" aria-label="NZBP home">
        <img src="./assets/icons/icon-192.png" alt="NZBP logo">
        <h1>NZBP</h1>
      </a>
      <nav aria-label="Theme switcher">
        <div class="theme">
          <button class="swatch" data-name="emerald" title="Emerald"></button>
          <button class="swatch" data-name="sapphire" title="Sapphire"></button>
          <button class="swatch" data-name="amethyst" title="Amethyst"></button>
          <button class="swatch" data-name="chrome" title="Chrome (light)"></button>
          <button class="swatch" data-name="neutral" title="Neutral"></button>
        </div>
      </nav>
    </header>

    <section class="panel hero" role="region" aria-labelledby="hero-title">
      <div>
        <h2 id="hero-title">Simple, modern, installable.</h2>
        <p>Use this app to save items with an amount and a link. Works offline. Export for backup and import on another device.</p>
        <div class="cta">
          <button class="btn" id="installBtn" aria-label="Install app">Install app</button>
          <a class="btn secondary" href="./guide.html">Open guide</a>
        </div>
      </div>
      <div class="card">
        <h3>Quick Add</h3>
        <label for="title">Title</label>
        <input id="title" type="text" placeholder="e.g. School Lunches">
        <label for="amount">Amount (number)</label>
        <input id="amount" type="number" inputmode="decimal" step="0.01" placeholder="e.g. 12.50">
        <label for="link">Link (optional)</label>
        <input id="link" type="url" placeholder="https://example.com">
        <div class="actions" style="margin-top:10px;">
          <button class="btn" id="addBtn">Add</button>
          <button class="btn secondary" id="clearForm">Clear</button>
        </div>
      </div>
    </section>

    <div id="installHint" class="panel hint">
      <strong>How to install:</strong>
      <span id="installHintText">Open the browser menu and choose “Install app”.</span>
    </div>

    <section class="panel" style="margin-top:8px;">
      <div class="card">
        <h3>Saved Items</h3>
        <table id="table">
          <thead>
            <tr><th>Title</th><th>Amount</th><th>Link</th><th>Actions</th></tr>
          </thead>
          <tbody id="rows"><tr><td colspan="4" class="muted">No items yet.</td></tr></tbody>
        </table>
        <div class="actions" style="margin-top:14px;">
          <button class="btn" id="exportBtn">Export</button>
          <input id="importInput" type="file" accept="application/json" style="display:none;">
          <button class="btn secondary" id="importBtn">Import</button>
          <button class="btn danger" id="resetBtn">Reset</button>
        </div>
        <p class="muted" style="margin-top:8px;">Export creates a JSON file you can save to Google Drive/Dropbox. Import loads that file on any device.</p>
      </div>
    </section>

    <footer>
      <p>© <span id="year"></span> NZBP</p>
    </footer>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // Theme persistence
    (function(){
      var saved = localStorage.getItem('theme') || 'emerald';
      if(saved && saved !== 'emerald') document.documentElement.setAttribute('data-theme', saved);
      document.querySelectorAll('.swatch').forEach(function(btn){
        btn.addEventListener('click', function(){
          var t = btn.getAttribute('data-name');
          if(t === 'emerald'){ document.documentElement.removeAttribute('data-theme'); }
          else { document.documentElement.setAttribute('data-theme', t); }
          localStorage.setItem('theme', t);
        });
      });
    })();

    // Tiny store
    const KEY = 'nzbp-items-v1';
    function load(){ try{ return JSON.parse(localStorage.getItem(KEY))||[] }catch(_){ return [] } }
    function save(data){ localStorage.setItem(KEY, JSON.stringify(data)); }
    function toast(msg){
      var t = document.getElementById('toast');
      t.textContent = msg; t.style.display='block';
      setTimeout(()=>{ t.style.display='none' }, 1600);
    }

    // Render table
    function render(){
      const tb = document.getElementById('rows');
      const data = load();
      tb.innerHTML = '';
      if(!data.length){
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 4; td.className = 'muted'; td.textContent = 'No items yet.';
        tr.appendChild(td); tb.appendChild(tr);
        return;
      }
      data.forEach((it, i) => {
        const tr = document.createElement('tr');
        const td1 = document.createElement('td'); td1.textContent = it.title || '';
        const td2 = document.createElement('td'); td2.textContent = (it.amount ?? '').toString();
        const td3 = document.createElement('td');
        if (it.link){
          const a = document.createElement('a'); a.href = it.link; a.textContent = 'Open'; a.target = '_blank'; a.rel = 'noopener noreferrer';
          td3.appendChild(a);
        } else { td3.textContent = '—'; }
        const td4 = document.createElement('td');
        const edit = document.createElement('button'); edit.className='btn secondary'; edit.textContent='Edit';
        const del = document.createElement('button'); del.className='btn danger'; del.textContent='Delete';
        edit.addEventListener('click', () => editItem(i));
        del.addEventListener('click', () => deleteItem(i));
        const wrap = document.createElement('div'); wrap.className='actions'; wrap.append(edit, del);
        td4.appendChild(wrap);
        tr.append(td1, td2, td3, td4);
        tb.appendChild(tr);
      });
    }

    function editItem(i){
      const data = load();
      const it = data[i];
      document.getElementById('title').value = it.title||'';
      document.getElementById('amount').value = it.amount ?? '';
      document.getElementById('link').value = it.link||'';
      data.splice(i,1); save(data); render();
      toast('Loaded into form. Edit & Add to save.');
    }
    function deleteItem(i){
      const data = load(); data.splice(i,1); save(data); render(); toast('Deleted.');
    }

    // Form handlers
    document.getElementById('addBtn').addEventListener('click', () => {
      const title = document.getElementById('title').value.trim();
      const amountStr = document.getElementById('amount').value.trim();
      const link = document.getElementById('link').value.trim();
      if(!title){ toast('Please enter a title.'); return; }
      const amount = amountStr ? Number(amountStr) : null;
      if(amountStr && Number.isNaN(amount)){ toast('Amount must be a number.'); return; }
      const data = load();
      data.push({title, amount, link});
      save(data); render();
      document.getElementById('title').value='';
      document.getElementById('amount').value='';
      document.getElementById('link').value='';
      toast('Saved.');
    });
    document.getElementById('clearForm').addEventListener('click', () => {
      document.getElementById('title').value='';
      document.getElementById('amount').value='';
      document.getElementById('link').value='';
    });

    // Export / Import / Reset
    document.getElementById('exportBtn').addEventListener('click', () => {
      const data = load();
      const blob = new Blob([JSON.stringify({version:1, items:data}, null, 2)], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'nzbp-backup.json';
      a.click();
      setTimeout(() => URL.revokeObjectURL(a.href), 1000);
      toast('Exported nzbp-backup.json');
    });
    document.getElementById('importBtn').addEventListener('click', () => {
      document.getElementById('importInput').click();
    });
    document.getElementById('importInput').addEventListener('change', (e) => {
      const file = e.target.files && e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = function() {
        try{
          const obj = JSON.parse(reader.result);
          if(Array.isArray(obj.items)) save(obj.items);
          else if(Array.isArray(obj)) save(obj);
          else throw new Error('Invalid format');
          render(); toast('Imported.');
        } catch(err){
          toast('Import failed: ' + err.message);
        }
      };
      reader.readAsText(file);
      e.target.value = '';
    });
    document.getElementById('resetBtn').addEventListener('click', () => {
      if(confirm('This will delete all saved items on this device. Continue?')){
        localStorage.removeItem(KEY); render(); toast('All items erased.');
      }
    });

    // Install prompt UX
    let deferredPrompt = null;
    const installBtn = document.getElementById('installBtn');
    const hintBar = document.getElementById('installHint');
    const hintText = document.getElementById('installHintText');

    installBtn.disabled = true; // start disabled

    function showHint() {
      if (!hintBar) return;
      const ua = navigator.userAgent.toLowerCase();
      let tip = 'Open the browser menu and choose “Install app”.';
      if (ua.includes('android') || ua.includes('mobile') || ua.includes('crios')) {
        tip = 'Tap the ⋮ menu in Chrome and choose “Install app”.';
      } else if (ua.includes('edg')) {
        tip = 'Click the app icon in Edge’s address bar, or ⋯ → Apps → Install this site as an app.';
      } else if (/mac|win|linux/.test(ua)) {
        tip = 'Click the “Install” icon in the address bar (a plus-in-a-square), or menu → “Install app”.';
      } else if (ua.includes('safari') && !ua.includes('chrome')) {
        tip = 'In Safari: Share → Add to Home Screen.';
      }
      hintText.textContent = tip;
      hintBar.style.display = 'flex';
    }

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.disabled = false;
      if (hintBar) hintBar.style.display = 'none';
    });

    installBtn.addEventListener('click', async () => {
      if(!deferredPrompt){ showHint(); return; }
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
      installBtn.disabled = true;
      installBtn.textContent = 'Installed';
    });

    // fallback hint if prompt doesn't fire
    setTimeout(() => { if (installBtn.disabled) showHint(); }, 1200);

    document.getElementById('year').textContent = new Date().getFullYear();

    // Service Worker -> sw.js
    (function() {
      if (!('serviceWorker' in navigator)) return;
      var base = location.pathname.replace(/\/[^/]*$/, '/');
      if (!base.endsWith('/')) base += '/';
      var swUrl = base + 'sw.js';
      navigator.serviceWorker.register(swUrl, { scope: base }).catch(function(err){
        console.log('SW registration failed:', err);
      });
    })();

    // Initial render
    render();
  </script>
</body>
</html>
